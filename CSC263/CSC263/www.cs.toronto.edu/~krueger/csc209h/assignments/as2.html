<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">

<HTML>
<HEAD>
<TITLE>CSC 209H Summer 2006</TITLE>
</HEAD>

<BODY bgcolor="#FBFBF0" LINK="#0000AA" VLINK="#602000">

<H1>CSC 209H: Assignment 2</H1>

<!--<p><b>Grading:</b> 20 marks.</p>-->

<p><b>Weight:</b> 10% of course grade.</p>

<p><b>Due date:</b> 10:00 p.m. Tuesday, July 4.</p>

<hr/>
<h2>Introduction</h2>

<p>
In this assignment you will be asked to write some C programs that
manipulate files and directories. You are free to use any standard
system or library calls available on CDF, but you must check the return
value from each function call for errors. Your assignment must compile
and run on the CDF system without any unavoidable compiler warnings or
errors.
</p>

<h2>Part 0 - memlayout</h2>

<p>
Write a short program in C (this shouldn't be more than 20 lines of code)
named <tt>memlayout</tt> that outputs:
</p>

<ul>
<li>its pid
<li>one memory address that belongs to the stack
<li>one memory address that belongs to the heap
<li>one memory address that belongs to the program's code segment
<li>one memory address that belongs to the program's data segment.
</ul>

<p>
The output from your program should be formatted EXACTLY as follows:
</p>

<blockquote>
<pre>
pid: 9999
stack: 0xaabbccdd
heap: 0x11223344
code segment: 0x89abcdef
data segment: 0x76543210
</pre>
</blockquote>

<p>
Your program should not take any command line arguments nor any input.
The output should be printed to standard output.
</p>

<h2>Hints and Clarifications</h2>

<ul>
<li>All these terms have been defined in the notes. You should use
your creativity to decide how to determine such addresses.
<li>You might find the <tt>apropos</tt> command useful.
<li>The manual section 2 contains system calls, and manual section 3
contain C library calls.
<li>Put the C code for your program in a file named <tt>memlayout.c</tt>.
</ul>

<HR>

<h2>Part 1 - mycut</h2>

<p>
The <tt>cut</tt> command is a useful system tool for extracting
selected parts of lines from files. One limitation is that <tt>cut</tt> does
not combine adjacent field delimiters (i.e., there is no way to ignore
empty fields). We would like to have a system tool similar to
<tt>cut</tt> that overcomes this limitation.
</p>

<p>
Your task is to write, in C, a program named <tt>mycut</tt>
that behaves somewhat like <tt>cut</tt>, with this additional feature.
Your <tt>mycut</tt> program should support the following usage:
</p>

<ul>
  <li><tt>mycut [options] ... [files] ...</tt>
</ul>

<p>
In the table which follows, the <i>byte-list</i>, <i>character-list</i>,
and <i>field-list</i> are one or more numbers or ranges (two numbers
separated by a dash) separated by commas. Bytes, characters, and fields
are numbered from starting at 1. Incomplete ranges may be given: "<tt>-m</tt>"
means "<tt>1-m</tt>"; "<tt>n-</tt>" means "<tt>n</tt>" through end of line
or last field.
</p>

<p>
The following options may be specified:
</p>

<ul>
  <li><tt>-b <i>byte-list</i></tt><br>
  Print only the bytes in positions listed in <i>byte-list</i>. Tabs and backspaces are treated like any other character; they take up 1 byte.
  <li><tt>-c <i>character-list</i></tt><br>
  Print only characters in positions listed in <i>character-list</i>. The same as <tt>-b</tt>.
  <li><tt>-f <i>field-list</i></tt><br>
  Print only the fields listed in <i>field-list</i>. Fields are separated by a TAB character (<tt>'\t'</tt> in C) by default.
  <li><tt>-d <i>delimiter</i></tt><br>
  For <tt>-f</tt>, fields are separated in the input by the first character in <i>delimiter</i> (default is TAB).
  <li><tt>-e</tt><br>
  For <tt>-f</tt>, ignore empty fields. Two or more consecutive field delimiters are treated as a single delimiter. (Different than <tt>cut</tt>.)
</ul>

<p>
If <tt>-f</tt> is specified and multiple fields are printed, printed fields
are separated by the delimiter character.
</p>

<p>
Your program should print the selected parts of each line in each 
file specified on the command line. If no files are specified, <tt>mycut</tt>
should read from standard input instead.
</p>

<p>
If there are not enough characters
or fields (if <tt>-f</tt> is specified) are present on a line to satisfy
a number of range in the <i>list</i>, that portion is not printed for that
line. In particular, if nothing is printed for a particular line, a
blank line should be output.
</p>

<p>
You may assume any command line argument that begins with a dash is meant to
be an option. You may assume all options precede any specified files.
You may assume that the option specifier (i.e., <tt>-d</tt>) and the
option argument (i.e., <i>delimiter</i>) are separate command line arguments.
</p>

<!--
<h2>Examples</h2>

<p>

</p>

<blockquote>
<pre>
</pre>
</blockquote>
-->

<h2>Hints and Clarifications</h2>

<ul>
<li>Start <b>now</b>! Try to get something simple working first before
adding extra functionality. Get the consecutive ranges of characters/fields
working first, then handle multiple ranges.</li>
<li>Put the C code for your program in a file named <tt>mycut.c</tt>.
A basic <tt>Makefile</tt> to help compile your program is available 
<a href="Makefile">here</a>.
<li>You <b>must</b> check the return values from each library function call
and take appropriate action based on these return values (such as printing
an error message, exiting with error, or continuing normally).
<li>You may find the standard library function <tt>perror</tt> useful for
printing error messages.
<li>For full marks, your <tt>mycut.c</tt> program must be
well-documented, follow good programming style, and be easily
understandable by the marker.</li>
</ul>

<hr>

<h2>Part 2 - organizer</h2>

<p>
In this question, you will write, in C, a program called
<tt>organizer</tt> that will sort a collection of mp3 files,
grouping them by album, year, and artist.
</p>

<p>
Suppose a given directory contains a number of mp3 files
that are named very methodically using the following convention:<br>
<tt>tracknum - artist - year - album - trackname.mp3</tt>
</p>

<p>
Your program should take an optional single argument: the path to a
directory containing such a collection of mp3 files.
If no argument is given, your program will operate on the current
working directory.
</p>

<p>
Your program should reorganize
the files so that they are filed in subdirectories. One subdirectory
per artist should be created. Inside this subdirectory, one
subdirectory per year for which there is at least one track for this
artist should be created. Inside the "year" subdirectory, create one
subdirectory per album for that year and artist. Finally, the mp3
files should be moved to the correct subdirectory and renamed so that
they are now simply "tracknum - trackname.mp3".
</p>

<p>
In addition, your program should create one directory per year for
which there is at least one track in the collection. That directory
will contain symbolic links to all albums released that year for which
at least one track exists. The symbolic link should be to the
directory containing the album, and should be named 
"<tt>artist - album</tt>".
</p>

<h2>Examples</h2>

</p>
A simple example should make things perfectly clear. Let the
following be the content of <tt>/home/user/mp3s</tt>:
</p>

<blockquote>
<pre>
02 - Portishead - 1997 - Portishead - All Mine.mp3
02 - Radiohead - 2001 - Amnesiac - Pyramid Song.mp3
03 - Radiohead - 2001 - I Might Be Wrong - Morning Bell.mp3
05 - Radiohead - 2001 - I Might Be Wrong - Idiotheque.mp3
06 - Radiohead - 1997 - OK Computer - Karma Police.mp3
</pre>
</blockquote>

<p>
After executing <tt>organizer /home/user/mp3s</tt>, the content of
<tt>/home/user/mp3s</tt> should be organized as follows:
</p>

<blockquote>
<pre>
Portishead
        1997
                Portishead
                        02 - All Mine.mp3
Radiohead
        1997
                OK Computer
                        06 - Karma Police.mp3
        2001
                Amnesiac
                        02 - Pyramid Song.mp3
                I Might Be Wrong
                        03 - Morning Bell.mp3
                        05 - Idiotheque.mp3

1997
        Portishead - Portishead (symlink to /home/user/mp3s/Portishead/1997/Portishead)
        Radiohead - OK Computer (symlink to /home/user/mp3s/Radiohead/1997/OK Computer)
2001
        Radiohead - Amnesiac (symlink to /home/user/mp3s/Radiohead/2001/Amnesiac)
        Radiohead - I Might Be Wrong (symlink to /home/user/mp3s/Radiohead/2001/I Might Be Wrong)
</pre>
</blockquote>


<h2>Hints and Clarifications</h2>

<ul>
<li>Put the C code for your program in a file named <tt>organizer.c</tt>.
<li>Put thought into the algorithm you plan to use, and consider what
you should do if directories already exist (perhaps from a previous
execution of <tt>organizer</tt>). Do you want to read the whole list
of files first, or handle them one at a time?
<li>You will probably find the <tt>opendir</tt>,
<tt>readdir</tt>, <tt>closedir</tt>,
<tt>mkdir</tt>, <tt>symlink</tt> and <tt>rename</tt>
functions very useful. The manual pages for these functions
are in chapters 2 and 3 of the manual.
<li>Be sure you understand the difference between hard links and soft
(symbolic) links.
<li>You might find the <tt>chdir</tt> function handy.
<li>It is probably better to use relative paths instead of absolute
paths when creating the symbolic links.
<li>For full marks, your <tt>organizer.c</tt> program must be
well-documented, follow good programming style, and be easily
understandable by the marker.
</ul>

<hr>

<h2>Learning Objectives</h2>
<ul>
<li>Basic C programs, arrays, structures, pointers.
<li>Writing basic C functions.
<!--<li>File and directory manipulation in a C program.
<li>The stat library function call.-->
<li>Command line argument processing in C.
<li>Variant behaviour of C programs based on option settings.
<!--<li>Managing large files efficiently in C.-->
<li>Using <tt>make</tt> and a <tt>Makefile</tt> to control compilation.
</ul>

<h2>What to hand in</h2>

<p>You will commit to the <code>a2</code> directory of your CSC209
repository the following files:</p>

<ul>
<li><code>memlayout.c</code>
<li><code>mycut.c</code>
<li><code>organizer.c</code>
<li>Any additional files needed by
<code>memlayout</code>, <code>mycut</code>, and <code>organizer</code>.
<li><code>Makefile</code>, containing commands to compile all programs
(<code>memlayout</code>, <code>mycut</code>, and <code>organizer</code>)
simply by running <tt>make</tt>
<li>Do not commit binary files (such as <tt>mycut</tt>) to the repository.
</ul>

<p>
Include your name, student number, CDF login name, and a brief description
of the usage of the program/contents of the file at the top of each file
you submit for marking.
</p>

<p>
You are strongly encouraged to take advantage of the version
control system and commit your work frequently so that you can keep
track of your progress.  Please note that perfectly fine (and even
recommended) that you keep any additional files related to this
assignment (such as files used for testing) under version control. The
markers will simply ignore such files.
</p>

<HR>

<TABLE>
<TR>
<TD>
<SMALL>
<!--Copyright &#169;
Richard Krueger
<BR>
All rights reserved.
<BR>-->
<SCRIPT LANGUAGE="JavaScript">
<!--
if (Date.parse(document.lastModified) != 0)
        document.write('<BR>Last update: ' + document.lastModified);
//-->
</SCRIPT>
</SMALL>
</TD>
</TR>
</TABLE>

</BODY>
</HTML>
