<html>
<head>
<meta name="source" content="$Source: /u/reid/teaching/csc209/05s-cvsroot/working/tut/using-cvs.html,v $"/>
<meta name="author" content="$Author: reid $"/>
<meta name="date" content="$Date: 2005/01/04 21:59:00 $"/>
<meta name="revision" content="$Revision: 1.1 $"/>
<link rel="stylesheet" type="text/css" href="../scjava.css"/>
<title>Software Design: Using CVS</title>
</head>
<body>

<h1>
<a href="../index.html">CSC209: Software Tools and Systems Programming</a>
<br/>
Using CVS
</h1>

<h2>Review</h2>

	<p class="i1">Master copies of files live in a central <em>repository</em></p>
	<p class="i1">Repository also records all <em>revisions</em> to files</p>
	<p class="i1">One or more users have <em>local copies</em> of files on their machines</p>
	<p class="i1">Users make changes to local copies at will</p>
	<p class="i1">Users can <em>synchronize</em> with master copy</p>
		<p class="i2">Copies changes from repository to local machine</p>
		<p class="i2">Notifies users of <em>conflicts</em> between their changes and changes to the master copy</p>
		<p class="i2">Users must edit files to <em>resolve</em> conflicts</p>
	<p class="i1">Users can <em>commit</em> changes to the master copy</p>
		<p class="i2">Writes their changes into the master copy so that other users can get them</p>
	<p class="i1">Users can <em>revert</em> to an older copy of a file</p>
		<p class="i2">Like an editor's "undo" command</p>

<h2>Local Use</h2>

<p><em>Note: <a href="setup-at-home.html">this page</a> has more
information on using CVS from home.</em></p>

<p>CVS uses three environment variables:</p>
<ul>
	<li><code>CVSROOT</code> tells CVS where to find its repository.</li>
	<li><code>CVS_RSH</code> tells CVS how to connect to remote machines.</li>
	<li><code>EDITOR</code> tells CVS what editor you want to use for log messages.</li>
</ul>

<p>If you are using a CDF machine, set CVSROOT to
<code>/u/csc209h/summer/pub/repo/<em>userid</em></code>, where
<code><em>userid</em></code> is your login ID.  You do not need to set
<code>CVS_RSH</code> for local use, but you should set
<code>EDITOR</code> to pico, vi, emacs, nedit or some other editor.</p>

<p>Once you have set your environment variables, you can get a clean
copy of the files that are in your repository. </p>


<pre class="code">
cvs co assignments
</pre>

<p>(You may want to do this 
in a special subdirectory you have set up for working on this
course.) You should now have a directory called <code>assignments</code> 
containing (at least) two sub-directories.  The first is called 
<code>CVS</code>.  It, and other directories with similar
names, holds administrative information that helps CVS keep track of
what you're doing, and what it needs to do.  <em>Never</em> delete
these files, or edit them directly.</p>

<p>The second directory of interest, <code>a1</code>, holds all the files
for Assignment one.  Other directories will be added as we go along.
</p>

<h3>Remote Use</h3>

</p>
<p>If you are using CVS remotely, you must set the
<code>CVS_RSH</code> environment variable on the remote machine
(St. George students: <em>not</em> on the lab machines) to point to your SSH client.  On
Linux, this is typically <code>/usr/bin/ssh</code>; on Windows, I set
it to <code>ssh</code>, and then make sure that <code>ssh.exe</code>
is on my path.

<p>You must then set the <code>CVSROOT</code> environment variable on
the remote machine to:</p>

<pre class="code">
:ext:<em>userid</em>@<em>host</em>.utoronto.ca:/u/csc209h/summer/pub/repo/<em>userid</em>
</pre>

<p>where <code><em>userid</em></code> is your login ID.  The first
field, "ext", tells CVS to use external password checking, i.e. to get
the CDF machines to check your password.  The second field (your
login, and <code><em>host</em>.utoronto.ca</code>) tells CVS who you
are, and what machine your repository is on.  The third field is then
the full path to your repository.</p>

<p>The way you set an environment variable depends on which shell you
are using.  The default on St. George CDF machines is tcsh; if you are
using it, the syntax is:</p>

<pre class="code">
setenv CVSROOT /u/csc209h/summer/pub/repo/userid
</pre>

<p>If you are using bash, on the other hand, the syntax is:</p>

<pre class="code">
export CVSROOT=/u/csc209h/summer/pub/repo/userid
</pre>

<p>Once your environment variables are set up, check out the course
exercises as described earlier.</p>

<h3>Key Commands</h3>

<dl>

<dt><code>cvs checkout projectname</code></dt>
<dd>
Copy a project from a repository to the local directory.
This command should only be run once.
</dd>

<dt><code>cvs add [-kb] [filenames...]</code></dt>
<dd>
Add one or more files or directories to the repository.
If the file(s) should be treated as binary (e.g. images),
use the <code>-kb</code> flag.
</dd>

<dt><code>cvs delete [-f] [filenames...]</code></dt>
<dd>
Delete one or more files from the repository.
The files must also be deleted from your local machine;
you can either do this before running the command,
or by using the <code>-f</code> flag.
Note that directories cannot be deleted
(which is one of CVS's big weaknesses).
</dd>

<dt><code>cvs update [-d] [filenames...]</code></dt>
<dd>
Update local files from the repository.
If a file has changed in the repository,
but has not been changed locally,
the changes from the repository are copied to the local machine.
If a file has been changed locally,
but not in the repository,
it will be marked as modified.
If changes have been made in both places,
CVS will signal a conflict,
which must be resolved (by editing the file)
before the local changes can be committed to the repository.
The <code>-d</code> flag causes this command to work on sub-directories recursively.
</dd>

<dt><code>cvs commit [-m message] [filenames...]</code></dt>
<dd>
Commit local changes to the repository.
This command can only be run <em>after</em> <code>cvs update</code>
(which compares local files to the repository),
and only after conflicts between local changes
and changes in the repository
have been resolved.
The <code>-m</code> flag can be used to provide a short log message on the command line.
If it isn't used,
CVS will launch the user's editor
to get a log message.
</dd>

<dt><code>cvs log [filenames...]</code></dt>
<dd>
Show the history of one or more files,
including revision numbers,
who made the change,
and log messages.
</dd>
</dl>

<h3>Reverting to Old Versions</h3>

<p>In order to get a file or files back into the state they were at a
particular time (e.g. in order to mark a student's submission), you
should use:</p>

<pre>
cvs update -D date
</pre>

where <code>date</code> is the moment in the past that you want to
synchronize with.  From the CVS manual:

<blockquote>
A wide variety of date formats are supported by CVS. The most standard
ones are ISO8601 (from the International Standards Organization) and
the Internet e-mail standard (specified in RFC822 as amended by
RFC1123).
</blockquote>

<p>ISO8601 dates have many variants but a few examples are:</p>

<pre>
1972-09-24
1972-09-24 20:05
</pre>

<p>(There are a lot more ISO8601 date formats, and CVS accepts many of
them.)  In addition to the dates allowed in Internet e-mail itself,
CVS also allows some of the fields to be omitted. For example:</p>

<pre>
24 Sep 1972 20:05
24 Sep
</pre>

<p>The date is interpreted as being in the local timezone, unless a
specific timezone is specified.</p>

<p>Updating a file to a particular date, or to an old revision, sets
the "sticky" tag on the file (see section 4.9 of the CVS manual).
When a file's sticky tag is set, "cvs update" will <em>not</em> work
on it.  This is to prevent you from reverting to an old version of a
file, then accidentally checking it in on top of someone else's more
recent changes.  You can get rid of sticky tags by typing:</p>

<pre>
cvs update -A
</pre>

<h3>Where Else to Look</h3>

<p>CVS Manual: <a href="http://www.cvshome.org/docs/manual/">http://www.cvshome.org/docs/manual/cvs.html</a></p>

<p>CDF Guide to CVS: <a href="http://www.cdf.toronto.edu/workathome/index.php3?id=39">http://www.cdf.toronto.edu/workathome/index.php3?id=39</a></p>

<h2>Common Problems</h2>

<p>Two problems with CVS have come up repeatedly during this course:</p>

<h3>Lock Files</h3>

<p>If CVS is complaining about lock files, it means that it thinks you
have started a check-in from one machine, but have not finished it
before starting a check-in from a second machine.  For example, if you
are checking in files from home, and your connection goes down (or you
use Control-C to stop the check-in), CVS will wait for you to finish
checking in from there before allowing you to check in from (for
example) the CDF lab.  As Section 10.5 of the CVS manual says:</p>

<blockquote>
    If several developers try to run CVS at the same time, one may get
    the following message:
    <pre>
    [11:43:23] waiting for bach's lock in /usr/local/cvsroot/foo
    </pre>
    CVS will try again every 30 seconds, and either continue with the
    operation or print the message again, if it still needs to
    wait. If a lock seems to stick around for an undue amount of time,
    find the person holding the lock and ask them about the cvs
    command they are running. If they aren't running a cvs command,
    look in the repository directory mentioned in the message and
    remove files which they own whose names start with
    <code>#cvs.rfl</code>, <code>#cvs.wfl</code>, or
    <code>#cvs.lock</code>.
</blockquote>

<h3>Sticky Bits</h3>

<p>If you use <code>cvs update -D</code> to restore files to the state
they were in at a particular time, or <code>cvs update -r</code> to
restore an old version of a file, CVS marks your local copy of that
file as "sticky".  This means that it will <em>not</em> update the
file the next time you do <code>cvs update</code>, or let you commit
it with <code>cvs commit</code>, since it knows you are now "behind
the times".  (To understand why, think about how other developers
working on the same project would feel if they had updated a file
three times, only to have you accidentally put it back the way it was
two weeks ago.)  You must use <code>cvs update -A</code> to remove the
sticky tags before you can check in.  See Section 4.9 of the CVS
manual for more information.</p>

<hr/>

<p>$Id: using-cvs.html,v 1.1 2005/01/04 21:59:00 reid Exp $</p>

</body>
</html>
