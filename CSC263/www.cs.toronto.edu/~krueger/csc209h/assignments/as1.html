<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">

<HTML>
<HEAD>
<TITLE>CSC 209H Summer 2006</TITLE>
</HEAD>

<BODY bgcolor="#FBFBF0" LINK="#0000AA" VLINK="#602000">

<H1>CSC 209H: Assignment 1</H1>

<!--<p><b>Grading:</b> 20 marks.</p>-->

<p><b>Weight:</b> 10% of course grade.</p>

<p><b>Due date:</b> 10:00 p.m. Monday, June 12, 10:00pm.</p>

<hr/>
<h2>Introduction</h2>

<p>
In this assignment you will be asked to write two shell scripts
(using <tt>sh</tt>) that manipulate files and directories.
</p>

<h2>Part 1 - fs</h2>

<p>
A typical question users may have regarding files on the file system is
how big are they? There are a number of programs that answer this question,
such as <tt>ls</tt> or <tt>du</tt>.
</p>

<p>
Sometimes we might want to find the size of all files (that match some
filename pattern) in all subdirectories. For example, we might want to
find the size of all C or text files in the current directory and all
subdirectories. It is possible to do this with <tt>find</tt>, or you
can write a <tt>sh</tt> script to accomplish this.
</p>

<p>
Your task will be to write a <tt>sh</tt> script (without using
<tt>find</tt>, <tt>ls</tt> or <tt>du</tt>) that takes
shell filename patterns, and reports the size of each file that
matches these patterns.
</p>

<p>
The <tt>fs</tt> script must support the following usage:
</p>

<ul>
  <li><tt>fs [-r] [-f] [-b|-k] filepatterns...</tt>
</ul>

<p>
If no switches are given, <tt>fs</tt> reports the size (in bytes,
as reported by <tt>stat</tt>)
of all files relative to the current directory that match the 
<i>filepatterns</i>, one per line. If a particular file matches more
than one pattern, it will be reported multiple times.
You may assume that any argument that begins with a dash, <tt>-</tt>,
is a command line switch, and all switches preceed any file patterns.
</p>

<p>
If the <tt>-k</tt> switch is given as an argument to <tt>fs</tt>,
the sizes will be reported in kilobytes instead of bytes. (Recall,
there are 1024 bytes in a kilobyte.) You may choose and document a
suitable rounding convention.
</p>

<p>
If the <tt>-b</tt> switch is given, the number of blocks (as reported
by <tt>stat</tt>) occupied by each file will be reported instead of
its size.
At most one of <tt>-k</tt> or <tt>-b</tt> may be specified.
</p>

<p>
If the <tt>-r</tt> switch is given, the <tt>fs</tt> script operates
recursively: not only files relative to the current directory reported,
but also any files relative to any subdirectories, and so on.
Only non-hidden subdirectories are considered. See the examples
for more details.
</p>

<p>
If the <tt>-f</tt> switch is given, only regular files are reported
by <tt>fs</tt> (ordinarily directories and other kinds of files may
have their sizes reported, but the <tt>-f</tt> switch inhibits this
behaviour).
</p>

<p>
The reporting format is the file size (or number of blocks), followed by
a tab character,
followed by the path to the file relative to the (original) current directory.
(See the examples for details.)
</p>

<p>
If no file patterns are given, or if no files match the given patterns,
your program should produce no output. For cases not covered by this
specification (such as the return status of your script or error handling),
you may specify and implement a reasonable behaviour.
</p>

<h2>Examples</h2>

<p>The following command reports the size of all C files in the current
directory. Note that the <tt>*</tt> is expanded by the shell.
</p>

<blockquote>
<pre>
$ fs *.c
162	a.c
938	b.c
</pre>
</blockquote>

<p>The following command reports the size of all C files in all
directories including and below the current directory.
Note that the <tt>*</tt> is passed directly to the script.
</p>

<blockquote>
<pre>
$ fs -r "*.c"
162	a.c
938	b.c
2490	subdir/xyz.c
727	threads/readn.c
661	threads/writen.c
</pre>
</blockquote>

<p>
The following command reports the size of all files stating
with s or named <tt>a.c</tt> in the current directory.
Notice that <tt>subdir</tt> is a directory.
</p>

<blockquote>
<pre>
$ fs 's*' a.c
31424	sol.txt
512	subdir
162	a.c
</pre>
</blockquote>

<p>
The following command repeats this, but omitting the directory.
</p>

<blockquote>
<pre>
$ fs -f 's*' a.c
31424	sol.txt
162	a.c
</pre>
</blockquote>

<p>
The following command reports the number of blocks in all C files
that are contained in the parent directory of some directory below
the current directory.
Notice that the same files are printed twice, once for each subdirectory.
</p>

<blockquote>
<pre>
$ fs -b -r '../*.c'
2	subdir/../a.c
2	subdir/../b.c
2	threads/../a.c
2	threads/../b.c
</pre>
</blockquote>

<h2>Hints and Clarifications</h2>

<ul>
<li>Start <b>now</b>! Try to get the basic functionality working first before
adding extra features. For instance, get the sizes of files in the current
directory working before adding <tt>-b</tt> or <tt>-k</tt> functions,
and then make it recursive.</li>

<li>Explore the man page for <tt>stat</tt>.
<li>Generally, you should only need the shell commands that we have
covered in lecture.</li>
<li>Do not use <tt>find</tt>, <tt>ls</tt> or <tt>du</tt> in your solution;
instead use shell filename expansion, recursion and the <tt>stat</tt> tool.
<li>Remember to <tt>chmod +x</tt> your script to make it executable.
<li>For full marks, your <tt>fs</tt> program must be
well-documented and easily understandable by the marker.</li>
</ul>

<hr>

<h2>Part 2 - vcardtoabook</h2>

<p>
A vCard is a virtual business card some people attach to their email
messages. It typically contains the name, contact details and address 
of the sender, which you might want to import into your address book.
</p>

<p>
Your job is to write a shell script (using <tt>sh</tt>) called
<tt>vcardtoabook</tt> that will take as input a vCard file, parse
(interpret) its contents, and add the information to a simple
address book (such as that used for the <tt>pine</tt> mailer).
</p>

<h3>The vCard format</h3>

<p>
The following is an example of such a vCard:
</p>

<blockquote>
<pre>
BEGIN:VCARD
VERSION:2.1
FN:John Doe III
N:Doe;John;;;III
BDAY:1/1/70
ADR;WORK:PO box 1;;123 College St.;Toronto;Ontario;M1M 1M1;Canada
TEL;PREF;MSG;WORK:999-123-4567
TEL;CELL:987-654-3210
EMAIL;INTERNET:jd@someisp.ca
EMAIL;INTERNET:johndoe@gmail.com
UID:9e1762c1d3a2da01f0f722486631b7b3
REV:2006-06-02T09\:27\:06Z
X-GENERATOR:vCardMaker 0.5.1
END:VCARD
</pre>
</blockquote>

<p>
Your script will read such a file from its standard input, extracting
the full name, primary email address, primary street address, and
primary telephone number, and create an entry in the <tt>.addressbook</tt>
file. (Typically the <tt>.addressbook</tt> would be located in the
user's home directory, but for this assignment we'll keep in the current
working directory to prevent modification of your own address book.)
</p>

<p>
Your script will be executed with no arguments.
From its standard input, your script will attempt to read a vCard.
The vCard begins with the line <tt>BEGIN:VCARD</tt>, and you should
ignore anything appearing before this line (think of the input being
an email message piped from the user's email program, with the vCard
occurring at the end of the message). Similarly, the vCard ends with
the line <tt>END:VCARD</tt> and you should ignore anything following
this line. You may assume you are given at most one vCard.
<p>

<p>
You should extract the following information from the input:
</p>
<ul>
<li>
The full (formatted) name of this person occurs on the line beginning
with <tt>FN:</tt>. You may assume there is at most one such line.

<li>The primary email address is contained on the first line that begins
with the string <tt>EMAIL;INTERNET:</tt>. There may be several such lines,
and there may be strings specifying non-internet email addresses (such as
AOL).

<li>The primary street address is contained on the first line that
begins with the string <tt>ADR</tt>. It may be a WORK address or
another kind of address. There may be zero or more address lines.

<li>The primary telephone number is contained on the line that begins
with <tt>TEL;PREF</tt>, or (if no such line appears) the first line that
begins with <tt>TEL</tt>. You are also required to extract what kind of
telephone number it is (such as whether it is a WORK, HOME, CELL number).
There may be zero or more telephone number lines.
</ul>

<h3>The <tt>.addressbook</tt> file</h3>

<p>
The <tt>.addressbook</tt> file is a text file consisting of a number of 
records. A line beginning with a non-space character is the start of a
record, while a line beginning with a space character is a continuation of
the previous line. The format of the records is discussed below.
</p>

<p>
To store the extracted information about this new contact, we will attempt
to add a line like the following to the end of the <tt>.addressbook</tt>
file:
</p>

<blockquote>
<pre>
john	John Doe III	John Doe III &lt;jd@someisp.ca&gt;		PO box 1;;123 College St.;Toronto;Ontario;M1M 1M1;Canada, WORK:999-123-4567
</pre>
</blockquote>

<p>
The first field is a unique nickname for this record: no other record in
the <tt>.addressbook</tt> file should use this nickname. The nickname should
not contain any spaces. Following the nickname is a tab character.
Next is the full name, followed by a tab, followed by the email address.
The email address begins with the full name, followed by a space, then
the actual email address within angle brackets.
Following the email address are <i>two</i> tab characters (the missing field
is used as the FCC, which we're ignoring), followed by the comments field.
</p>

<p>
The comments field should be filled as follows. Should both an address and
a telephone number be extracted from the vCard, the address should appear
first, followed by a comma and a space, followed by the phone number.
Should only one of the address and telephone number be found, it should
appear in the comments field. If neither an address nor a telephone number
is found in the vCard, the comments field should remain blank.
</p>

<h3>Avoiding duplicates</h3>

<p>
It is possible (and likely) that the user will use your script to attempt to
add a duplicate contact to the address book. You script should avoid doing so.
</p>

<p>
We will define a <i>duplicate entry</i> in the <tt>.addressbook</tt> file as
two records containing the identical email address.
Before adding the line
described above to the <tt>.addressbook</tt> file, your script should verify
that the email address does not already appear in the file. If it does,
your script should not modify the <tt>.addressbook</tt> file.
</p>

<p>
If the <tt>.addressbook</tt> file does not previously exist in the current
directory, your script should create it when adding the appropriate record.
</p>

<!--
<h2>Examples</h2>

<p>
</p>

<blockquote>
<pre>
</pre>
</blockquote>

<p>
</p>

<blockquote>
<pre>
</pre>
</blockquote>
-->

<h2>Hints and Clarifications</h2>

<ul>
<li>Start now! Handle the simple case of all desired lines present in
the input exactly once, then handle the other cases.
<li>Your script only needs to work on version 2.1 vCards, and only to the
extent described in these specifications.
<li>You can generate your own vCards (for testing) using
<a href="http://vcardmaker.wackomenace.co.uk/">this vCardMaker site</a>.
<li>You can use the address book feature of <tt>pine</tt> to create and
test the <tt>.addressbook</tt> file... just be careful if you keep your
own address book in <tt>pine</tt> and make a backup copy!
<li>There is no need to modify the address from the way it appears in the vCard.
<li>You may use temporary files if you wish, though it is not necessary
for completing this program.
<li>For full marks, your <tt>vcardtoabook</tt> program must be
well-documented and easily understandable by the marker.</li>
<li>For your personal interest, you can look at the complete
<a href="http://vcardmaker.wackomenace.co.uk/docs/vCard-2.1-Spec.pdf">vCard 2.1 specificication (PDF)</a>.
<li>You may assume that each property in the vCard is contained entirely on
a single line (the actual spec permits properties to be broken over several
lines, but we'll ignore that here for simplicity).
<li>You may assume there are no semicolons or colons in the data fields.
<li>You get to choose the unique nickname: choose some reasonable string.
</ul>

<hr>

<h2>Learning Objectives</h2>
<ul>
<li>Shell control structures and variables.</li>
<li>Running external programs from a shell program.</li>
<li>Shell quoting.</li>

<li>Reading and writing a file from the shell.</li>
<!--<li>Setting the <code>PATH</code> variable</li>
<li>Automated testing</li>-->
</ul>

<h2>What to hand in</h2>

<p>You will commit to the <code>a1</code> directory of your CSC209
repository the following files:</p>

<ul>
<li><code>fs</code>
<li><code>vcardtoabook</code>
<!--<li>Any additional files needed by <code>...</code>-->
</ul>

<p>Please remember to make your shell scripts executable by ensuring that
	  the first line is "<code>#!/bin/sh</code>".
</p>

<p>
You are strongly encouraged to take advantage of the version
control system and commit your work frequently so that you can keep
track of your progress.  Please note that perfectly fine (and even
recommended) that you keep any additional files related to this
assignment (such as files used for testing) under version control. The
markers will simply ignore such files.
</p>

<HR>

<TABLE>
<TR>
<TD>
<SMALL>
<!--Copyright &#169;
Richard Krueger
<BR>
All rights reserved.
<BR>-->
<SCRIPT LANGUAGE="JavaScript">
<!--
if (Date.parse(document.lastModified) != 0)
        document.write('<BR>Last update: ' + document.lastModified);
//-->
</SCRIPT>
</SMALL>
</TD>
</TR>
</TABLE>

</BODY>
</HTML>
